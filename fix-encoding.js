const fs = require('fs');
const path = require('path');

// Map of mojibake patterns to correct Vietnamese text
const mojibakeMap = {
  // Common sequences
  'Äang bÃ¡n': 'Đang bán',
  'Táº¡m ngá»«ng': 'Tạm ngưng',
  'Káº¿t thÃºc': 'Kết thúc',
  'ÄÃ£ xÃ³a': 'Đã xóa',
  'ÄÃ£': 'Đã',
  'Lá»—i': 'Lỗi',
  'táº£i': 'tải',
  'danh sÃ¡ch': 'danh sách',
  'sáº£n pháº©m': 'sản phẩm',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'áº£nh': 'ảnh',
  'Vui lÃ²ng': 'Vui lòng',
  'Ä‘iá»n': 'điền',
  'tÃªn': 'tên',
  'vÃ ': 'và ',
  'giÃ¡': 'giá',
  'há»£p lá»‡': 'hợp lệ',
  'Cáº­p nháº­t': 'Cập nhật',
  'thÃ nh cÃ´ng': 'thành công',
  'cáº­p nháº­t': 'cập nhật',
  'tráº¡ng thÃ¡i': 'trạng thái',
  'Báº¡n cÃ³': 'Bạn có',
  'cháº¯c muá»‘n': 'chắc muốn',
  'xÃ³a': 'xóa',
  'Quáº£n lÃ½': 'Quản lý',
  'Tá»•ng cá»™ng': 'Tổng cộng',
  'ThÃªm': 'Thêm',
  'má»›i': 'mới',
  'TÃ¬m kiáº¿m': 'Tìm kiếm',
  'Táº¥t cáº£': 'Tất cả',
  'HÃ¬nh áº£nh': 'Hình ảnh',
  'HÃ¬nh': 'Hình',
  'Danh má»¥c': 'Danh mục',
  'GiÃ¡': 'Giá',
  'Äáº·c Ä‘iá»ƒm': 'Đặc điểm',
  'Ä‘áº·c': 'đặc',
  'Ä‘iá»ƒm': 'điểm',
  'NgÃ y táº¡o': 'Ngày tạo',
  'NgÃ y': 'Ngày',
  'HÃ nh Ä‘á»™ng': 'Hành động',
  'HÃ nh': 'Hành',
  'Ä‘á»™ng': 'động',
  'Äang': 'Đang',
  'KhÃ´ng cÃ³': 'Không có',
  'KhÃ´ng': 'Không',
  'nÃ o': 'nào',
  'Ä‘áº§u tiÃªn': 'đầu tiên',
  'Sá»­a': 'Sửa',
  'KÃ­ch hoáº¡t': 'Kích hoạt',
  'XÃ³a': 'Xóa',
  'TrÆ°á»›c': 'Trước',
  'Chi tiáº¿t': 'Chi tiết',
  'ThÃ´ng tin': 'Thông tin',
  'Ä‘áº§y Ä‘á»§': 'đầy đủ',
  'Ä‘áº§y': 'đầy',
  'Ä‘á»§': 'đủ',
  'cá»§a': 'của',
  'MÃ´ táº£': 'Mô tả',
  'MÃ´': 'Mô',
  'táº£': 'tả',
  'Sá»‘ lÆ°á»£ng': 'Số lượng',
  'Sá»‘': 'Số',
  'lÆ°á»£ng': 'lượng',
  'Chá»n': 'Chọn',
  'Há»§y': 'Hủy',
  'á»§': 'ử',
  'áº¢': 'Ả',
  'Lá»—i khi': 'Lỗi khi',
  'Quáº£n': 'Quản',
  'lÃ½': 'lý',
  'cÃ³': 'có',
  'Táº¡m': 'Tạm',
  'ngá»«ng': 'ngưng',
  'Káº¿t': 'Kết',
  'thÃºc': 'thúc',
  'Äáº£': 'Đả',
  'xÃ': 'xó',
  'pháº©': 'phẩ',
  'Äang táº£i': 'Đang tải',
  'Äang táº£i...': 'Đang tải...',
  'KhÃ´ng cÃ³ sáº£n pháº©m nÃ o': 'Không có sản phẩm nào',
  'ThÃªm sáº£n pháº©m Ä‘áº§u tiÃªn': 'Thêm sản phẩm đầu tiên',
  'ThÃªm sáº£n pháº©m má»›i': 'Thêm sản phẩm mới',
  'Sá»­a sáº£n pháº©m': 'Sửa sản phẩm',
  'ÄÃ³ng': 'Đóng',
  'ÄÃ¡nh giÃ¡': 'Đánh giá',
  ' Sá»­a': ' Sửa',
  'TÃ¬m': 'Tìm',
  'kiáº¿m': 'kiếm',
  'tráº¡ng': 'trạng',
  'thÃ¡i': 'thái',
  'Äáº·c': 'Đặc',
  'Ä‘iá»n': 'điền',
  'tÃªn': 'tên',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'giÃ¡': 'giá',
  'há»£p': 'hợp',
  'lá»‡': 'lệ',
  'Cáº­p': 'Cập',
  'nháº­t': 'nhật',
  'thÃ ': 'thà',
  'cÃ´ng': 'công',
  'Lá»—i': 'Lỗi',
  'khi': 'khi',
  'cáº­p': 'cập',
  'nháº­t': 'nhật',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'ÄÃ£ chuyá»ƒn': 'Đã chuyển',
  'sang': 'sang',
  'ÄÃ£ xÃ³a': 'Đã xóa',
  'Lá»—i khi xÃ³a': 'Lỗi khi xóa',
  'Lá»—i khi cáº­p nháº­t': 'Lỗi khi cập nhật',
  'tráº¡ng': 'trạng',
  'thÃ¡i': 'thái',
  'Báº¡n': 'Bạn',
  'cÃ³': 'có',
  'cháº¯c': 'chắc',
  'muá»‘n': 'muốn',
  'xÃ³a': 'xóa',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'Quáº£n': 'Quản',
  'lÃ½': 'lý',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'Tá»•ng': 'Tổng',
  'cá»™ng': 'cộng',
  'ThÃªm': 'Thêm',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'má»›i': 'mới',
  'TÃ¬m': 'Tìm',
  'kiáº¿m': 'kiếm',
  'theo': 'theo',
  'tÃªn': 'tên',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'Táº¥t': 'Tất',
  'cáº£': 'cả',
  'tráº¡ng': 'trạng',
  'thÃ¡i': 'thái',
  'Äang': 'Đang',
  'bÃ¡n': 'bán',
  'Táº¡m': 'Tạm',
  'ngá»«ng': 'ngưng',
  'Káº¿t': 'Kết',
  'thÃºc': 'thúc',
  'HÃ¬nh': 'Hình',
  'áº£nh': 'ảnh',
  'Danh': 'Danh',
  'má»¥c': 'mục',
  'GiÃ¡': 'Giá',
  'Äáº·c': 'Đặc',
  'Ä‘iá»ƒm': 'điểm',
  'NgÃ y': 'Ngày',
  'táº¡o': 'tạo',
  'HÃ nh': 'Hành',
  'Ä‘á»™ng': 'động',
  'Äang': 'Đang',
  'táº£i': 'tải',
  'KhÃ´ng': 'Không',
  'cÃ³': 'có',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'nÃ o': 'nào',
  'ThÃªm': 'Thêm',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'Ä‘áº§u': 'đầu',
  'tiÃªn': 'tiên',
  'Sá»­a': 'Sửa',
  'KÃ­ch': 'Kích',
  'hoÃ¡º¡t': 'hoạt',
  'XÃ³a': 'Xóa',
  'TrÆ°á»›c': 'Trước',
  'Chi': 'Chi',
  'tiáº¿t': 'tiết',
  'ThÃ´ng': 'Thông',
  'tin': 'tin',
  'Ä‘áº§y': 'đầy',
  'Ä‘á»§': 'đủ',
  'cá»§a': 'của',
  'MÃ´': 'Mô',
  'táº£': 'tả',
  'Sá»‘': 'Số',
  'lÆ°á»£ng': 'lượng',
  'Chá»n': 'Chọn',
  'Há»§y': 'Hủy',
  // Additional patterns for AddProduct.tsx
  'vÃ ': 'và ',
  'Sáº£n': 'Sản',
  'phẩm': 'phẩm',
  'Ä‘Ã£': 'đã',
  'ÄÆ°á»£c': 'Được',
  'thÃªm': 'thêm',
  'thÃ nh': 'thành',
  'cÃ³': 'có',
  'lá»—i': 'lỗi',
  'xáº£y': 'xảy',
  'ra': 'ra',
  'khi': 'khi',
  'thÃªm': 'thêm',
  'Táº¡o': 'Tạo',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'má»›i': 'mới',
  'cho': 'cho',
  'cá»­a': 'cửa',
  'hÃ ng': 'hàng',
  'cá»§a': 'của',
  ' báº¡n': ' bạn',
  'ThÃ´ng': 'Thông',
  'tin': 'tin',
  'sáº£n': 'sản',
  'pháº©m': 'phẩm',
  'TÃªn': 'Tên',
  'sản': 'sản',
  'phẩm': 'phẩm',
  'Nháº­p': 'Nhập',
  'tÃªn': 'tên',
  'sản': 'sản',
  'phẩm': 'phẩm',
  'MÃ´': 'Mô',
  'táº£': 'tả',
  'chi': 'chi',
  'tiáº¿t': 'tiết',
  'vá»': 'về',
  'sản': 'sản',
  'phẩm': 'phẩm',
  'HÃ¬nh': 'Hình',
  'áº£nh': 'ảnh',
  'sản': 'sản',
  'phẩm': 'phẩm',
  'KÃ©o': 'Kéo',
  'tháº£': 'thả',
  'hÃ¬nh': 'hình',
  'áº£nh': 'ảnh',
  'vÃ ': 'và ',
  'Ä‘Ã¢y': 'đây',
  'hoáº·c': 'hoặc',
  'click': 'click',
  'Ä‘á»ƒ': 'để',
  'chá»n': 'chọn',
};

function fixEncoding(filePath) {
  let content = fs.readFileSync(filePath, 'utf8');
  let originalContent = content;
  
  // Sort by length (longer patterns first) to avoid partial replacements
  const patterns = Object.keys(mojibakeMap).sort((a, b) => b.length - a.length);
  
  for (const pattern of patterns) {
    const regex = new RegExp(pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
    content = content.replace(regex, mojibakeMap[pattern]);
  }
  
  if (content !== originalContent) {
    fs.writeFileSync(filePath, content, 'utf8');
    console.log(`Fixed: ${filePath}`);
    return true;
  }
  return false;
}

// Files to fix
const filesToFix = [
  'fe/src/pages/seller/Products.tsx',
  'fe/src/pages/seller/EditProduct.tsx',
  'fe/src/pages/seller/AddProduct.tsx',
  'fe/src/pages/seller/Orders.tsx',
  'fe/src/pages/seller/Revenue.tsx',
  'fe/src/pages/seller/Reviews.tsx',
];

const baseDir = __dirname;
let fixedCount = 0;

for (const file of filesToFix) {
  const filePath = path.join(baseDir, file);
  if (fs.existsSync(filePath)) {
    if (fixEncoding(filePath)) {
      fixedCount++;
    }
  } else {
    console.log(`File not found: ${filePath}`);
  }
}

console.log(`\nFixed ${fixedCount} files.`);
